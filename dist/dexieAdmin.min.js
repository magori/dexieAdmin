!function e(t,n,a){function i(o,l){if(!n[o]){if(!t[o]){var s="function"==typeof require&&require;if(!l&&s)return s(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return i(n?n:e)},u,u.exports,e,t,n,a)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<a.length;o++)i(a[o]);return i}({1:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();n.DbManagerController=function(){function e(t,n,i,r,o){"ngInject";var l=this;a(this,e),this.$timeout=r,this.$log=n,this.$scope=t,this.$uibModal=i,this.dbManager=o,this.dbManager.onRefresh(function(){l.tables=l.dbManager.getTables(),l.displayData(l.selectedTable)}),this.tables=this.dbManager.getTables(),this.displayData(this.tables[0])}return e.$inject=["$scope","$log","$uibModal","$timeout","dbManagerService"],i(e,[{key:"animate",value:function(e,t,n){var a=this;e.stopPropagation();var i=angular.element(e.target),r=i.find("i");r.length&&(i=r),i.addClass(t+" animated"),n.then(function(){return a.$timeout(function(){return i.removeClass(t+" animated")})})}},{key:"loadAll",value:function(e){this.animate(e,"fa-spin",this.dbManager.loadAll())}},{key:"load",value:function(e,t){this.animate(e,"fa-spin",this.dbManager.load(t))}},{key:"hasActionLoad",value:function(e){return this.dbManager.hasActionLoad(e)}},{key:"hasDelete",value:function(e){return this.dbManager.hasDelete(e)}},{key:"createDb",value:function(){return this.dbManager.createDb()}},{key:"deleteAllDb",value:function(e){this.animate(e,"faa-flash",this.dbManager.deleteAllTable())}},{key:"delete",value:function(e,t){this.animate(e,"faa-flash",this.dbManager.delete(t))}},{key:"forceDelete",value:function(e,t){this.animate(e,"faa-flash",this.dbManager.delete(t))}},{key:"drop",value:function(e){this.animate(e,"faa-flash",this.dbManager.drop())}},{key:"dump",value:function(e){this.animate(e,"faa-flash",this.dbManager.dump())}},{key:"save",value:function(e,t){this.animate(e,"faa-flash",this.dbManager.dumpTable(t))}},{key:"search",value:function(e){var t=this;this.dbManager.search(e,this.selectedTable).then(function(e){t.dataTable=e,t.$scope.$digest()})}},{key:"displayData",value:function(e){var t=this;this.selectedTable=e,this.selectedTableIndexes=this.dbManager.resolveColumns(e),this.dbManager.buildData(e).then(function(e){return t.dataTable=e}).then(function(){return t.$scope.$digest()})}},{key:"displayRow",value:function(e){var t=this,n=this;this.$log.log(e),this.$uibModal.open({controller:["$scope","json","$uibModalInstance","$timeout",function(e,a,i,r){delete a.$$hashKey,e.obj={data:a},e.editorLoaded=function(e){e.set(a),r(function(){e.expandAll()},150)},e.options={mode:"tree",modes:["tree","text"],history:!0},e.del=function(){t.dbManager.deleteObject(t.selectedTable,e.obj.data).then(function(){n.displayData(n.selectedTable),i.close(e.obj.data)})},e.save=function(){n.selectedTable.put(e.obj.data).then(function(){n.displayData(n.selectedTable),i.close(e.obj.data)})},e.cancel=function(){i.dismiss("cancel")}}],templateUrl:"displayJson.html",controllerAs:"jsonCtrl",size:"lg",resolve:{json:function(){return e}}})}}]),e}()},{}],2:[function(e,t,n){"use strict";function a(){"ngInject";var e={restrict:"E",template:'<style>\r\n\r\n</style><script type="text/ng-template" id="displayJson.html"><div class="modal-body"> <!-- <div json-editor model="json" options="options" style="height: 400px;"/> --> <div ng-jsoneditor="editorLoaded" ng-model="obj.data" options="options" style="height: 80vh;"></div> <!-- <json-tree json="json" ng-model="json" edit-level="low" collapsed-level="-1"></json-tree> --> <!-- <json-editor schema="mySchema" startval="json" on-change="onChange($editorValue)"></json-editor> --> <!-- <div style="height: 400px;" json-editor type="text" model="json" options="options"/> --> <!-- <json-editor-input model="json" configuration="configuration"/> --> <!-- <textarea ng-model="json" json class="form-control" style="height:75vh"> </textarea> --> </div> <div class="modal-footer"> <button class="btn btn-danger" type="button" ng-click="del()">Delete</button> <button class="btn btn-primary" type="button" ng-click="save()">Save</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button> </div></script><div class="row"><div class="col-xs-3"><div class="panel panel-default"><div class="panel-heading clearfix"><div class="btn-toolbar" role="toolbar"><div class="pull-left panel-title"><span class="badge">{{ dbManger.tables.length}}</span></div><div class="btn-group pull-right"><div ng-click="dbManger.dump($event)" class="btn btn-default" title="Dump"><i class="fa fa-floppy-o" aria-hidden="true"></i></div><div ng-click="dbManger.loadAll($event)" class="btn btn-default" title="Load all"><i class="fa fa-refresh" aria-hidden="true"></i></div><div ng-click="dbManger.deleteAllDb($event)" class="btn btn-default" title="Empty DB"><i class="fa fa-trash-o" aria-hidden="true"></i></div><div ng-click="dbManger.drop($event)" class="btn btn-danger" title="Drop"><i class="fa fa-trash-o" aria-hidden="true"></i></div></div></div></div><div class="list-group" ng-repeat="table in dbManger.tables track by table.name" ng-click="dbManger.displayData(table)"><div class="list-group-item" ng-class="dbManger.selectedTable.name===table.name ? \'active\':\'\'" style="cursor:pointer"><div class="list-group-item-heading clearfix"><div class="pull-left panel-title"><span class="badge">{{table.nbRow}}</span> <span class="panel-title" style="padding-top: 7.5px;">{{table.name}}</span></div><div class="btn-group pull-right"><div ng-if="dbManger.hasActionLoad(table)" ng-click="dbManger.load($event,table)" class="btn btn-default" title="Load table"><i class="fa fa-refresh" aria-hidden="true"></i></div><div ng-click="dbManger.save($event, table)" class="btn btn-default" title="Dump table"><i class="fa fa-floppy-o" fa-stack-1x aria-hidden="true"></i></div><div ng-if="dbManger.hasDelete(table)" ng-click="dbManger.delete($event, table)" class="btn btn-default" title="Clear table"><i class="fa fa-trash-o" fa-stack-1x aria-hidden="true"></i></div><div ng-if="!dbManger.hasDelete(table)" ng-click="dbManger.forceDelete($event, table)" class="btn btn-danger" title="Force clear table"><i class="fa fa-trash-o" fa-stack-1x aria-hidden="true"></i></div></div></div><p class="list-group-item-text"><i class="fa fa-key" aria-hidden="true"></i> {{table.schema.primKey.name}} : {{table.schema.primKey.auto}}</p><p class="list-group-item-text"></p>index: <span ng-repeat="indexe in table.schema.indexes">{{indexe.src}},</span><p></p></div></div></div></div><div class="col-xs-9"><div class="panel panel-default"><div class="panel-heading">{{dbManger.selectedTable.name}}</div><div class="panel-body"><form><div class="row"><div class="form-group col-xs-12"><div class="input-group input-group"><span class="input-group-addon"><i class="fa fa-search" aria-hidden="true"></i></span> <input type="text" class="form-control" ng-change="dbManger.search(dbManger.searchValue)" ng-model-options="{ debounce: 250 }" ng-model="dbManger.searchValue"> <span class="input-group-addon"><span class="badge">{{dbManger.dataTable.length}}</span></span></div></div></div></form><div style="height: 70vh !important;overflow-y: auto;"><table class="table table-striped table-condensed"><colgroup><col class="del"><col class="{{::dbManger.selectedTable.schema.primKey.name}}"><col ng-repeat="indexe in dbManger.selectedTable.schema.indexes" class="{{::indexe.name}}"></colgroup><thead><tr><th><input type="checkbox" name="del"></th><th><i class="fa fa-key" aria-hidden="true"></i>PK</th><th ng-repeat="indexe in dbManger.selectedTableIndexes">{{::indexe}}</th></tr></thead><tbody><tr ng-repeat="data in dbManger.dataTable | limitTo:150" ng-click="dbManger.displayRow(data)"><td><input type="checkbox" name="del"></td><td>{{data[dbManger.selectedTable.schema.primKey.name]}}</td><td ng-repeat="indexe in dbManger.selectedTableIndexes">{{data[indexe]}}</td></tr></tbody></table></div></div></div></div></div>',controller:i.DbManagerController,controllerAs:"dbManger",bindToController:!0};return e}Object.defineProperty(n,"__esModule",{value:!0}),n.NgDexieAdminDirective=a;var i=e("./dbManager.controller")},{"./dbManager.controller":1}],3:[function(e,t,n){"use strict";var a=e("./service/dbManager.service"),i=e("./dbManager/ngDexieAdmin.directive");angular.module("dexieAdmin",["ui.bootstrap","angular-json-editor","ng.jsoneditor"]).config(["JSONEditorProvider",function(e){e.configure({defaults:{options:{iconlib:"fontawesome4",theme:"bootstrap3",disable_edit_json:!1,disable_properties:!0,disable_collapse:!0}}})}]).service("dbManagerService",a.DbManagerService).directive("ngDexieAdmin",i.NgDexieAdminDirective)},{"./dbManager/ngDexieAdmin.directive":2,"./service/dbManager.service":5}],4:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=function(){function e(){"ngInject";a(this,e),this.rn="\r\n"}return i(e,[{key:"config",value:function(e){e&&(this.db=e.db,this.dbName=this.db.name+"",this.tables=this.db.tables,this.tableDef=this.createTblesDef())}},{key:"dumpTable",value:function(e){var t=this;return e.toArray(function(n){var a=t.rn,i=JSON.stringify(n);return a+"//-"+e.name+a+" db."+e.name+".bulkPut("+i+")"})}},{key:"createTblesDef",value:function(){var e={};return this.db.tables.map(function(t){var n=[t.schema.primKey].concat(t.schema.indexes),a=n.map(function(e){return e.src}).join(",");e[t.name]=a}),e}},{key:"dump",value:function(){var e=this,t=this.db,n=this,a=this.rn,i=new Promise(function(i){t.open().then(function(){var e="var db = new Dexie('"+t.name+"') "+a+" db.version("+t.verno+").stores({ "+a,i=n.createTblesDef();return e+=Object.keys(i).map(function(e){var t=i[e];return"  "+e+": '"+t+"'"}).join(","+a),""+a+e+"});"+a}).then(function(a){var r=t.tables.map(function(e){return n.dumpTable(e)});return Promise.all(r).then(function(t){i(a+"//#### Datas #####"+e.rn+t.join(";")+";")}),a}).finally(function(){})});return i}}]),e}();n.DbDump=r},{}],5:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.DbManagerService=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=e("./dbDump.service.js"),l=function(){function e(t){"ngInject";a(this,e),this.config(t),this.previsouSearch="",this.countTupleForEachTable()}return e.$inject=["ngDexieAdminConfig"],r(e,[{key:"config",value:function(e){this.config=e,this.db=e.getDb(),this.tables=this.orderTables(this.db.tables),this.dbDump=new o.DbDump,this.dbDump.config({db:this.db});var t=this.resolveConfigType("load");this.actionsLoad=t,this.context=e.context,this.onNewDb=e.onNewDb()}},{key:"getTables",value:function(){return this.tables}},{key:"orderTables",value:function(e){var t=this.resolveConfigType("order"),n=[];for(var a in t)n.push({name:a,order:t[a]});return n.sort(function(e,t){return t.order-e.order}),n.map(function(t){var n=e.findIndex(function(e){return e.name==t.name}),a=e.splice(n,1)[0];e.unshift(a)}),e}},{key:"columnsToDisplay",value:function(e){return this.resolveConfigType("columns")[e]}},{key:"resolveColumns",value:function(e){var t=this.columnsToDisplay(e.name);t||(t={}),e.schema.indexes.forEach(function(e){void 0===t[e.name]&&(t[e.name]=!0)});var n=[];return n=Object.keys(t).filter(function(e){var n=t[e];return n!==!1})}},{key:"buildData",value:function(e){var t=this.resolveColumns(e),n=t.filter(function(e){return e.includes(".")}),a=[];return n.forEach(function(e){a.push({key:e,value:e.split(".")})}),e.toArray().then(function(e){return e.map(function(e){return a.forEach(function(t){var n=t.key,a=t.value;e[n]=a.reduce(function(e,t){return e[t]?e[t]:""},e)}),e}),e}).then(function(e){return e})}},{key:"resolveConfigType",value:function(e){var t=this,n={};return Object.keys(this.config.tablesConfig()).forEach(function(a){var i=t.config.tablesConfig()[a];i&&void 0!=i[e]&&(n[a]=i[e])}),n}},{key:"onRefresh",value:function(e){this.onRefresh=e}},{key:"hasActionLoad",value:function(e){return this.resolveActionLoad(e)}},{key:"hasDelete",value:function(e){var t=this.resolveConfigType("noDelete");return t[e.name]===!1||void 0===t[e.name]}},{key:"resolveActionLoad",value:function(e){return this.actionsLoad[e.name]}},{key:"deleteAllTable",value:function(){var e=this;return Promise.all(this.tables.map(function(t){return!!e.hasDelete(t)&&e.delete(t)}))}},{key:"delete",value:function(e){var t=this;return e.clear().then(function(){return t.countTupleTable(e)}).then(function(){return t.onRefresh()})}},{key:"loadAll",value:function(){var e=this;return Promise.all(this.tables.map(function(t){return e.load(t)}))}},{key:"deleteObject",value:function(e,t){var n=e.schema.primKey.name;return e.delete(t[n])}},{key:"load",value:function(e){var t=this,n=this.resolveActionLoad(e);if(n){var a=this.context?n.call(this.context):n(),i=this;return a&&a.then?a.then(function(){return i.countTupleTable(e)}).then(function(){return t.onRefresh()}):new Pormise(function(){t.countTupleTable(e),t.onRefresh()})}}},{key:"createDb",value:function(){var e=new Dexie(this.dbDump.dbName);return e.version(1).stores(this.dbDump.tableDef),e}},{key:"drop",value:function(){var e=this;return this.db.delete().then(function(){return e.createDb().open()}).then(function(t){e.db=t,e.onNewDb&&e.onNewDb(e.db),e.tables=t.tables,e.dbDump.config({db:t}),e.countTupleForEachTable()})}},{key:"dump",value:function(){var e=this;return this.dbDump.dump().then(function(t){return e.createFileAndDowload(t)})}},{key:"dumpTable",value:function(e){var t=this;return this.dbDump.dumpTable(e).then(function(e){return t.createFileAndDowload(e)})}},{key:"countTupleForEachTable",value:function(){var e=this;return this.tables.map(function(t){e.countTupleTable(t)})}},{key:"countTupleTable",value:function(e){return e.count().then(function(t){e.nbRow=t})}},{key:"search",value:function e(t,n){var a=this,e=t.toUpperCase();if(0!=e.indexOf(":"))return this.buildData(n).then(function(t){return t=t.map(function(e){return e.valstring=a.valuesToString(e),e}).filter(function(t){return t.valstring.includes(e)})});var r=function(){var t=e.substr(1).split("=");if(t.length>1){var r=function(){var e=t[0].trim().toLowerCase();return{v:{v:a.buildData(n).then(function(n){return n[0][e]&&(n=n.filter(function(n){var a=n[e];return!isNaN(parseFloat(a))&&isFinite(a)?a==1*t[1]:a.toUpperCase().includes(t[1])})),n})}}}();if("object"===("undefined"==typeof r?"undefined":i(r)))return r.v}return{v:new Promise(function(){})}}();return"object"===("undefined"==typeof r?"undefined":i(r))?r.v:void 0}},{key:"createFileAndDowload",value:function(e){var t=new Blob([e],{type:"text/plain"}),n=window.URL.createObjectURL(t),a=document.createElement("a");a.style="display: none",a.href=n,a.download="dump_"+(new Date).getTime()+".txt",document.body.appendChild(a),a.click(),setTimeout(function(){document.body.removeChild(a),window.URL.revokeObjectURL(n)},50)}},{key:"valuesToString",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var a=e[n];a instanceof Object?t+=this.valuesToString(a):t=t+" "+e[n]}return t.toUpperCase()}}]),e}();n.DbManagerService=l},{"./dbDump.service.js":4}]},{},[3]);
//# sourceMappingURL=dexieAdmin.min.js.map
